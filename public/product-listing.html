<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Listing - Modern E-Commerce</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='50%25' y='50%25' font-size='90' text-anchor='middle' dominant-baseline='central'%3E🛒%3C/text%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        /* CSS Custom Properties (Variables) */
        :root {
            --color-primary: #5a77ff; /* A vibrant blue for primary actions */
            --color-primary-light: #7a9bff;
            --color-primary-dark: #3a5bff;
            --color-accent: #ff6f61; /* A contrasting red for highlights/sale */
            --color-accent-light: #ff8e81;
            --color-text-dark: #2c3e50; /* Dark text for contrast */
            --color-text-light: #ecf0f1; /* Light text for dark backgrounds */
            --color-background-light: #f5f8fb; /* Light background */
            --color-background-card: #ffffff; /* White for cards */
            --color-border: #e0e0e0; /* Light border */
            --color-shadow-light: rgba(0, 0, 0, 0.08); /* Subtle shadow */
            --color-shadow-medium: rgba(0, 0, 0, 0.15); /* Stronger shadow */
            --color-success: #2ecc71;
            --color-error: #e74c3c;

            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;

            --font-family-primary: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-size-base: 1rem;
            --font-size-sm: 0.875rem;
            --font-size-md: 1.125rem;
            --font-size-lg: 1.5rem;
            --font-size-xl: 2rem;
            --font-size-xxl: 2.5rem;

            --border-radius-sm: 0.25rem;
            --border-radius-md: 0.5rem;
            --border-radius-lg: 1rem;

            --transition-speed-fast: 0.15s;
            --transition-speed-normal: 0.3s;
        }

        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-family-primary);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--color-text-dark);
            background-color: var(--color-background-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal scroll from off-canvas menu */
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color var(--transition-speed-fast) ease-in-out;
        }

        a:hover {
            color: var(--color-primary-dark);
            text-decoration: underline;
        }

        h1, h2, h3, h4, h5, h6 {
            line-height: 1.2;
            margin-bottom: var(--spacing-sm);
            color: var(--color-text-dark);
        }

        h1 { font-size: clamp(var(--font-size-lg), 4vw, var(--font-size-xxl)); }
        h2 { font-size: clamp(var(--font-size-md), 3vw, var(--font-size-xl)); }
        h3 { font-size: clamp(var(--font-size-base), 2.5vw, var(--font-size-lg)); }

        button {
            cursor: pointer;
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-base);
            transition: all var(--transition-speed-normal) ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            white-space: nowrap;
        }

        button.primary {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            box-shadow: 0 4px 10px var(--color-shadow-light);
        }

        button.primary:hover {
            background-color: var(--color-primary-dark);
            box-shadow: 0 6px 15px var(--color-shadow-medium);
            transform: translateY(-2px);
        }

        button.outline {
            background-color: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
        }

        button.outline:hover {
            background-color: var(--color-primary-light);
            color: var(--color-text-light);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        input[type="text"],
        input[type="search"],
        input[type="number"],
        select {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: var(--font-size-base);
            color: var(--color-text-dark);
            transition: border-color var(--transition-speed-fast) ease-in-out, box-shadow var(--transition-speed-fast) ease-in-out;
        }

        input[type="text"]:focus,
        input[type="search"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);
        }

        /* Accessibility: Skip to Content */
        .skip-link {
            position: absolute;
            left: -9999px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
            z-index: 9999;
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            text-decoration: none;
        }

        .skip-link:focus {
            left: var(--spacing-sm);
            top: var(--spacing-sm);
            width: auto;
            height: auto;
        }

        /* Top Navigation Bar */
        .header-nav {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: var(--spacing-sm) var(--spacing-md);
            box-shadow: 0 2px 15px var(--color-shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }

        .header-nav .brand-logo {
            font-size: var(--font-size-lg);
            font-weight: bold;
            color: var(--color-primary-dark);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .header-nav .brand-logo::before {
            content: '🛒';
            font-size: var(--font-size-lg);
        }

        .header-nav .search-bar {
            flex-grow: 1;
            max-width: 500px;
            position: relative;
        }

        .header-nav .search-bar input {
            width: 100%;
            padding-right: var(--spacing-xl); /* Space for search icon */
            font-size: var(--font-size-sm);
        }

        .header-nav .search-bar .search-icon {
            position: absolute;
            right: var(--spacing-sm);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-primary);
        }

        .header-nav .search-bar .autocomplete-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--color-background-card);
            border: 1px solid var(--color-border);
            border-top: none;
            border-radius: 0 0 var(--border-radius-sm) var(--border-radius-sm);
            box-shadow: 0 4px 10px var(--color-shadow-light);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none; /* Controlled by JS */
        }
        .header-nav .search-bar .autocomplete-results ul {
            list-style: none;
            padding: 0;
        }
        .header-nav .search-bar .autocomplete-results li {
            padding: var(--spacing-xs) var(--spacing-sm);
            cursor: pointer;
        }
        .header-nav .search-bar .autocomplete-results li:hover {
            background-color: var(--color-background-light);
        }

        .header-nav .nav-icons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .header-nav .nav-icon {
            background: none;
            border: none;
            color: var(--color-primary);
            font-size: var(--font-size-lg);
            position: relative;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-sm);
        }

        .header-nav .nav-icon:hover {
            background-color: rgba(var(--color-primary-rgb), 0.1);
            transform: translateY(-1px);
        }

        .header-nav .nav-icon .count-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--color-accent);
            color: var(--color-text-light);
            font-size: 0.7em;
            padding: 0.2em 0.5em;
            border-radius: 50%;
            min-width: 1.5em;
            height: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(30%, -30%);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Icon fonts (simulated with CSS for common symbols) */
        .icon-user::before { content: '👤'; }
        .icon-cart::before { content: '🛒'; }
        .icon-search::before { content: '🔍'; }
        .icon-filter::before { content: '⚙️'; } /* Mobile filter icon */
        .icon-heart::before { content: '❤️'; }
        .icon-eye::before { content: '👁️'; }
        .icon-plus::before { content: '+'; }
        .icon-minus::before { content: '-'; }
        .icon-arrow-up::before { content: '⬆️'; }
        .icon-grid::before { content: '▦'; }
        .icon-list::before { content: '☰'; }
        .icon-star-filled::before { content: '⭐'; }
        .icon-star-empty::before { content: '☆'; }
        .icon-x::before { content: '✕'; } /* Close icon */

        /* Breadcrumbs */
        .breadcrumbs {
            background-color: var(--color-background-card);
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
            font-size: var(--font-size-sm);
        }

        .breadcrumbs ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .breadcrumbs li {
            display: flex;
            align-items: center;
        }

        .breadcrumbs li:not(:last-child)::after {
            content: '/';
            margin-left: var(--spacing-xs);
            color: var(--color-border);
        }

        .breadcrumbs a {
            color: var(--color-text-dark);
            text-decoration: none;
        }

        .breadcrumbs a:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        .breadcrumbs li:last-child {
            font-weight: bold;
            color: var(--color-primary-dark);
        }

        /* Promotional Hero Banner */
        .hero-banner {
            background: linear-gradient(135deg, var(--color-primary-light), var(--color-accent-light));
            color: var(--color-text-light);
            padding: var(--spacing-xl) var(--spacing-md);
            text-align: center;
            margin-bottom: var(--spacing-md);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 20px var(--color-shadow-medium);
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            transform: translateY(0); /* For animation */
            transition: transform var(--transition-speed-normal) ease-out;
            margin-top: var(--spacing-md);
        }

        .hero-banner h1 {
            color: var(--color-text-light);
            margin-bottom: var(--spacing-sm);
        }

        .hero-banner p {
            font-size: var(--font-size-md);
            margin-bottom: var(--spacing-md);
            opacity: 0.9;
        }

        /* Main Content Layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr; /* Mobile: full width */
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            flex-grow: 1;
            max-width: 1400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .main-container {
                grid-template-columns: 280px 1fr; /* Tablet/Desktop: sidebar + content */
            }
        }

        /* Filter Sidebar */
        .filter-sidebar {
            background-color: var(--color-background-card);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            box-shadow: 0 4px 10px var(--color-shadow-light);
            height: fit-content; /* Ensure it doesn't expand unnecessarily */
            position: sticky; /* Sticky on desktop */
            top: calc(var(--spacing-md) + 60px); /* Adjust based on header height */
        }

        @media (max-width: 767px) {
            .filter-sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 80%; /* Off-canvas width */
                max-width: 320px;
                transform: translateX(-100%); /* Hidden by default */
                transition: transform var(--transition-speed-normal) ease-in-out;
                z-index: 1001; /* Above main content, below modal */
                box-shadow: 0 0 20px rgba(0,0,0,0.3);
                padding-top: calc(var(--spacing-lg) + 60px); /* Space for header */
                overflow-y: auto;
            }
            .filter-sidebar.active {
                transform: translateX(0);
            }
            .filter-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 1000;
                display: none;
            }
            .filter-overlay.active {
                display: block;
            }
            .filter-sidebar .close-btn {
                position: absolute;
                top: var(--spacing-md);
                right: var(--spacing-md);
                background: none;
                border: none;
                font-size: var(--font-size-lg);
                color: var(--color-text-dark);
                z-index: 1002; /* Above sidebar content */
                padding: var(--spacing-xs);
                border-radius: 50%;
                transition: background-color var(--transition-speed-fast);
            }
            .filter-sidebar .close-btn:hover {
                background-color: var(--color-background-light);
            }
            .filter-toggle-button {
                display: flex; /* Show on mobile */
                background-color: var(--color-primary);
                color: var(--color-text-light);
                font-size: var(--font-size-sm);
                padding: var(--spacing-xs) var(--spacing-sm);
                border-radius: var(--border-radius-sm);
                gap: var(--spacing-xs);
                align-items: center;
            }
            .filter-toggle-button:hover {
                background-color: var(--color-primary-dark);
            }
        }

        @media (min-width: 768px) {
            .filter-toggle-button {
                display: none; /* Hide on desktop */
            }
            .filter-sidebar .close-btn {
                display: none;
            }
        }

        .filter-sidebar h3 {
            margin-top: 0;
            margin-bottom: var(--spacing-md);
            color: var(--color-primary-dark);
            font-size: var(--font-size-md);
        }

        .filter-group {
            margin-bottom: var(--spacing-md);
        }

        .filter-group details {
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .filter-group details:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
        }

        .filter-group summary {
            font-weight: bold;
            cursor: pointer;
            padding: var(--spacing-xs) 0;
            color: var(--color-text-dark);
            position: relative;
            outline: none;
            list-style: none; /* Hide default arrow */
        }

        .filter-group summary::-webkit-details-marker {
            display: none; /* Hide default arrow for Webkit */
        }

        .filter-group summary::after {
            content: '▼'; /* Custom arrow */
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            transition: transform var(--transition-speed-fast) ease-in-out;
        }

        .filter-group details[open] summary::after {
            transform: translateY(-50%) rotate(180deg);
        }

        .filter-group .filter-content {
            padding-top: var(--spacing-sm);
            max-height: 200px;
            overflow-y: auto;
        }

        /* Category Tree */
        .category-tree ul {
            list-style: none;
            padding-left: var(--spacing-sm);
        }

        .category-tree li a {
            display: block;
            padding: var(--spacing-xs) 0;
            color: var(--color-text-dark);
            transition: all var(--transition-speed-fast);
        }

        .category-tree li a:hover {
            color: var(--color-primary);
            padding-left: var(--spacing-xs);
            text-decoration: none;
        }

        /* Price Range Slider (simplified) */
        .price-range {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .price-range .price-inputs {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .price-range input[type="number"] {
            width: 80px;
            text-align: center;
        }

        /* Checkbox styles */
        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-xs);
            cursor: pointer;
            font-size: var(--font-size-sm);
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: var(--spacing-xs);
            appearance: none;
            width: 18px;
            height: 18px;
            border: 1px solid var(--color-primary);
            border-radius: var(--border-radius-sm);
            position: relative;
            outline: none;
            transition: background-color var(--transition-speed-fast), border-color var(--transition-speed-fast);
        }

        .checkbox-group input[type="checkbox"]:checked {
            background-color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 5px;
            width: 5px;
            height: 9px;
            border: solid var(--color-text-light);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        /* Color Swatches */
        .color-swatches {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .color-swatches label {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            position: relative;
            transition: border-color var(--transition-speed-fast);
        }

        .color-swatches input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .color-swatches input[type="radio"]:checked + label {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);
        }
        .color-swatches input[type="radio"]:focus + label {
            outline: 2px solid var(--color-primary-light);
            outline-offset: 2px;
        }

        /* Clear Filters Button */
        .filter-sidebar .clear-filters-btn {
            width: 100%;
            margin-top: var(--spacing-md);
        }

        /* Main Product Grid Area */
        .product-content-area {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .product-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            background-color: var(--color-background-card);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            box-shadow: 0 2px 5px var(--color-shadow-light);
        }

        .product-controls .view-toggle button {
            background-color: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text-dark);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
        }

        .product-controls .view-toggle button.active {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border-color: var(--color-primary);
        }

        .product-controls .view-toggle button:hover:not(.active) {
            background-color: var(--color-background-light);
        }

        .product-grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            /* Smooth transitions for grid layout changes */
            transition: grid-template-columns var(--transition-speed-normal) ease-in-out;
        }

        .product-grid-container.list-view {
            grid-template-columns: 1fr; /* Single column for list view */
        }

        /* Product Card */
        .product-card {
            background-color: var(--color-background-card);
            border-radius: var(--border-radius-md);
            box-shadow: 0 4px 15px var(--color-shadow-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-speed-normal) ease-in-out, box-shadow var(--transition-speed-normal) ease-in-out;
            position: relative; /* For badges */
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px var(--color-shadow-medium);
        }

        .product-card .product-image-placeholder {
            width: 100%;
            padding-top: 75%; /* 4:3 aspect ratio */
            background: linear-gradient(45deg, #a1c4fd, #c2e9fb);
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--color-border);
            transition: transform var(--transition-speed-normal) ease-in-out;
        }

        .product-card:hover .product-image-placeholder {
            transform: scale(1.03);
        }

        .product-card .product-image-placeholder::before {
            content: 'Product Image';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: var(--font-size-md);
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
            opacity: 0.8;
        }

        .product-card .product-info {
            padding: var(--spacing-sm);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .product-card .product-name {
            font-size: var(--font-size-md);
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--color-text-dark);
            text-decoration: none;
        }

        .product-card .product-name:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        .product-card .product-price {
            display: flex;
            align-items: baseline;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
        }

        .product-card .current-price {
            font-size: var(--font-size-lg);
            font-weight: bold;
            color: var(--color-primary-dark);
        }

        .product-card .original-price {
            font-size: var(--font-size-sm);
            color: #888;
            text-decoration: line-through;
        }

        .product-card .product-rating {
            font-size: var(--font-size-sm);
            color: #f39c12; /* Star color */
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .product-card .product-rating .icon-star-filled::before,
        .product-card .product-rating .icon-star-empty::before {
            font-size: 1em; /* Ensure stars are the correct size */
        }
        .product-card .product-rating .rating-count {
            color: #666;
            font-size: 0.8em;
            margin-left: var(--spacing-xs);
        }

        .product-card .product-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto; /* Push actions to bottom */
            gap: var(--spacing-sm);
        }

        .product-card .product-actions .add-to-cart {
            flex-grow: 1;
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-sm);
        }

        .product-card .product-actions .wishlist-btn,
        .product-card .product-actions .quick-view-btn {
            background-color: var(--color-background-light);
            color: var(--color-primary);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--color-border);
            font-size: var(--font-size-md); /* Make icon bigger */
        }
        .product-card .product-actions .wishlist-btn:hover,
        .product-card .product-actions .quick-view-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-text-light);
        }

        /* Product Badges */
        .product-card .product-badge {
            position: absolute;
            top: var(--spacing-sm);
            left: var(--spacing-sm);
            background-color: var(--color-accent);
            color: var(--color-text-light);
            padding: 0.3em 0.6em;
            border-radius: var(--border-radius-sm);
            font-size: 0.75em;
            font-weight: bold;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .product-card .product-badge.new { background-color: var(--color-success); }
        .product-card .product-badge.limited { background-color: var(--color-error); }


        /* List View Specific Styles */
        .product-grid-container.list-view .product-card {
            flex-direction: row;
            align-items: center;
            padding: var(--spacing-sm);
            gap: var(--spacing-md);
        }

        .product-grid-container.list-view .product-image-placeholder {
            width: 150px;
            min-width: 150px;
            height: 112.5px; /* 4:3 of 150px */
            padding-top: 0;
            border-right: 1px solid var(--color-border);
            border-bottom: none;
            border-radius: var(--border-radius-sm);
        }
        .product-grid-container.list-view .product-image-placeholder::before {
            font-size: var(--font-size-sm);
        }

        .product-grid-container.list-view .product-info {
            flex-direction: row;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--spacing-sm) var(--spacing-md);
            padding: 0;
            flex-grow: 1;
        }
        .product-grid-container.list-view .product-name {
            flex-basis: 100%;
            margin-bottom: 0;
            font-size: var(--font-size-base);
        }
        .product-grid-container.list-view .product-price {
            margin-bottom: 0;
        }
        .product-grid-container.list-view .product-rating {
            margin-bottom: 0;
        }
        .product-grid-container.list-view .product-actions {
            flex-basis: 100%;
            justify-content: flex-end; /* Push buttons to right */
            margin-top: 0;
            gap: var(--spacing-xs);
        }
        .product-grid-container.list-view .product-actions .add-to-cart {
            width: auto;
            flex-grow: 0;
            padding: var(--spacing-xs) var(--spacing-md);
        }
        .product-grid-container.list-view .product-badge {
            top: var(--spacing-xs);
            left: calc(150px + var(--spacing-md) + var(--spacing-xs)); /* Offset by image + gap + padding */
        }
        @media (max-width: 500px) {
            .product-grid-container.list-view .product-card {
                flex-direction: column; /* Stack back on small mobile */
                align-items: stretch;
            }
            .product-grid-container.list-view .product-image-placeholder {
                width: 100%;
                min-width: unset;
                height: unset;
                padding-top: 75%;
                border-bottom: 1px solid var(--color-border);
                border-right: none;
                border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
            }
            .product-grid-container.list-view .product-info {
                flex-direction: column;
                padding: var(--spacing-sm);
                align-items: flex-start;
            }
            .product-grid-container.list-view .product-actions {
                justify-content: space-between;
            }
            .product-grid-container.list-view .product-badge {
                top: var(--spacing-sm);
                left: var(--spacing-sm);
            }
        }


        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-md);
        }

        .pagination button {
            background-color: var(--color-background-card);
            border: 1px solid var(--color-border);
            color: var(--color-text-dark);
            min-width: 40px;
            min-height: 40px;
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-sm);
            transition: all var(--transition-speed-fast);
        }

        .pagination button.active,
        .pagination button:hover:not(:disabled) {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            border-color: var(--color-primary);
        }
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--color-background-card);
            color: var(--color-text-dark);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            background-color: var(--color-background-card);
            border-radius: var(--border-radius-md);
            box-shadow: 0 4px 10px var(--color-shadow-light);
            margin: var(--spacing-md) 0;
        }
        .empty-state h3 {
            color: var(--color-accent);
            margin-bottom: var(--spacing-sm);
        }
        .empty-state p {
            margin-bottom: var(--spacing-md);
        }
        .empty-state button {
            background-color: var(--color-accent);
        }
        .empty-state button:hover {
            background-color: var(--color-accent-light);
        }


        /* Product Quick View Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed-normal) ease-in-out, visibility var(--transition-speed-normal) ease-in-out;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--color-background-card);
            border-radius: var(--border-radius-lg);
            box-shadow: 0 8px 30px var(--color-shadow-medium);
            padding: var(--spacing-lg);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: transform var(--transition-speed-normal) ease-in-out;
            display: flex;
            flex-direction: column;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-close-btn {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            background: none;
            border: none;
            font-size: var(--font-size-lg);
            color: var(--color-text-dark);
            padding: var(--spacing-xs);
            border-radius: 50%;
            transition: background-color var(--transition-speed-fast);
        }

        .modal-close-btn:hover {
            background-color: var(--color-background-light);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        @media (min-width: 768px) {
            .modal-body {
                flex-direction: row;
            }
        }

        .modal-image-gallery {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            min-width: 300px;
        }

        .modal-image-gallery .main-image-placeholder {
            width: 100%;
            padding-top: 75%;
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            border-radius: var(--border-radius-md);
            position: relative;
        }
        .modal-image-gallery .main-image-placeholder::before {
            content: 'Large Image';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.7);
            font-size: var(--font-size-lg);
        }

        .modal-image-gallery .thumbnail-images {
            display: flex;
            gap: var(--spacing-xs);
            overflow-x: auto;
            padding-bottom: var(--spacing-xs); /* For scrollbar */
        }

        .modal-image-gallery .thumbnail-images .thumb-placeholder {
            width: 80px;
            height: 60px;
            background: linear-gradient(90deg, #d3cce3, #e9e4f1);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color var(--transition-speed-fast);
            flex-shrink: 0;
        }
        .modal-image-gallery .thumbnail-images .thumb-placeholder.active,
        .modal-image-gallery .thumbnail-images .thumb-placeholder:hover {
            border-color: var(--color-primary);
        }

        .modal-product-details {
            flex: 1;
        }

        .modal-product-details h2 {
            margin-top: 0;
            color: var(--color-primary-dark);
        }
        .modal-product-details .product-description {
            font-size: var(--font-size-sm);
            color: #555;
            margin-bottom: var(--spacing-md);
        }

        .modal-product-details .options-group {
            margin-bottom: var(--spacing-md);
        }

        .modal-product-details .options-group label {
            font-weight: bold;
            display: block;
            margin-bottom: var(--spacing-xs);
        }

        .modal-product-details .quantity-selector {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-xs);
        }

        .modal-product-details .quantity-selector button {
            width: 40px;
            height: 40px;
            font-size: var(--font-size-lg);
            background-color: var(--color-background-light);
            color: var(--color-primary);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--color-border);
        }
        .modal-product-details .quantity-selector button:hover {
            background-color: var(--color-primary);
            color: var(--color-text-light);
        }

        .modal-product-details .quantity-selector input {
            width: 60px;
            height: 40px;
            text-align: center;
            -moz-appearance: textfield; /* Hide arrows for Firefox */
        }
        .modal-product-details .quantity-selector input::-webkit-outer-spin-button,
        .modal-product-details .quantity-selector input::-webkit-inner-spin-button {
            -webkit-appearance: none; /* Hide arrows for Chrome, Safari */
            margin: 0;
        }


        .modal-product-details .modal-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .modal-product-details .modal-actions .add-to-cart-modal {
            width: 100%;
            padding: var(--spacing-sm);
        }
        .modal-product-details .modal-actions .view-full-product {
            width: 100%;
            text-align: center;
            font-size: var(--font-size-sm);
        }

        /* Toast/Snackbar Notifications */
        .toast-container {
            position: fixed;
            bottom: var(--spacing-lg);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            z-index: 3000;
            pointer-events: none; /* Allow clicks through */
        }

        .toast {
            background-color: rgba(var(--color-text-dark-rgb), 0.9);
            color: var(--color-text-light);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            box-shadow: 0 4px 15px var(--color-shadow-medium);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity var(--transition-speed-normal) ease-out, transform var(--transition-speed-normal) ease-out;
            min-width: 250px;
            text-align: center;
            pointer-events: auto; /* Re-enable clicks for the toast itself */
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success { background-color: rgba(46, 204, 113, 0.9); }
        .toast.error { background-color: rgba(231, 76, 60, 0.9); }

        /* "You Might Also Like" Carousel */
        .related-products {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-md) 0;
            background-color: var(--color-background-card);
            border-radius: var(--border-radius-md);
            box-shadow: 0 4px 10px var(--color-shadow-light);
            overflow: hidden; /* Hide scrollbar if content is small */
        }
        .related-products h2 {
            margin: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
            color: var(--color-primary-dark);
        }

        .related-products .products-carousel {
            display: flex;
            gap: var(--spacing-md);
            overflow-x: auto;
            padding: var(--spacing-xs) var(--spacing-md) var(--spacing-md) var(--spacing-md);
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
        }

        .related-products .products-carousel::-webkit-scrollbar {
            height: 8px;
        }

        .related-products .products-carousel::-webkit-scrollbar-track {
            background: var(--color-background-light);
            border-radius: 10px;
        }

        .related-products .products-carousel::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 10px;
        }

        .related-products .products-carousel::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary-light);
        }

        .related-products .product-card {
            min-width: 280px; /* Fixed width for carousel items */
            flex-shrink: 0;
            scroll-snap-align: start;
        }

        /* Footer */
        .footer {
            background-color: var(--color-text-dark);
            color: var(--color-text-light);
            padding: var(--spacing-xl) var(--spacing-md);
            margin-top: var(--spacing-xl);
        }

        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: var(--spacing-lg);
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-section {
            flex: 1;
            min-width: 180px;
        }

        .footer-section h4 {
            color: var(--color-primary-light);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-md);
        }

        .footer-section p {
            font-size: var(--font-size-sm);
            opacity: 0.8;
            margin-bottom: var(--spacing-sm);
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
        }

        .footer-section ul li {
            margin-bottom: var(--spacing-xs);
        }

        .footer-section ul a {
            color: var(--color-text-light);
            text-decoration: none;
            font-size: var(--font-size-sm);
            opacity: 0.8;
        }

        .footer-section ul a:hover {
            color: var(--color-primary-light);
            opacity: 1;
            text-decoration: underline;
        }

        .social-icons {
            display: flex;
            gap: var(--spacing-sm);
        }

        .social-icon {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--color-text-light);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-md);
            transition: background-color var(--transition-speed-fast);
        }

        .social-icon:hover {
            background-color: var(--color-primary-light);
        }

        .newsletter-form {
            display: flex;
            margin-top: var(--spacing-sm);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }

        .newsletter-form input {
            flex-grow: 1;
            border: none;
            padding: var(--spacing-xs) var(--spacing-sm);
            background-color: transparent;
            color: var(--color-text-light);
            font-size: var(--font-size-sm);
        }

        .newsletter-form input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .newsletter-form button {
            background-color: var(--color-primary);
            color: var(--color-text-light);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 0;
        }

        .newsletter-form button:hover {
            background-color: var(--color-primary-dark);
        }

        .footer-bottom {
            text-align: center;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: var(--font-size-sm);
            opacity: 0.7;
        }

        /* Back-to-Top Button */
        .back-to-top {
            position: fixed;
            bottom: var(--spacing-md);
            right: var(--spacing-md);
            background-color: var(--color-primary);
            color: var(--color-text-light);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-lg);
            box-shadow: 0 4px 10px var(--color-shadow-medium);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all var(--transition-speed-normal) ease-in-out;
            z-index: 999;
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Helper: for debugging color vars */
        :root {
            --color-primary-rgb: 90, 119, 255;
            --color-text-dark-rgb: 44, 62, 80;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="header-nav" role="banner">
        <a href="#" class="brand-logo">ModernShop</a>
        <div class="search-bar">
            <input type="search" placeholder="Search products..." aria-label="Search products" id="global-search-input">
            <span class="search-icon icon-search"></span>
            <div class="autocomplete-results" id="autocomplete-results">
                <ul>
                    <!-- Autocomplete suggestions will be inserted here by JS -->
                </ul>
            </div>
        </div>
        <div class="nav-icons">
            <button class="nav-icon" aria-label="User Account"><span class="icon-user"></span></button>
            <button class="nav-icon" aria-label="Shopping Cart">
                <span class="icon-cart"></span>
                <span class="count-badge" id="cart-item-count">0</span>
            </button>
            <button class="filter-toggle-button" aria-controls="filter-sidebar" aria-expanded="false" id="mobile-filter-toggle">
                <span class="icon-filter"></span> Filter
            </button>
        </div>
    </header>

    <nav class="breadcrumbs" aria-label="Breadcrumb">
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Electronics</a></li>
            <li>Smartphones</li>
        </ul>
    </nav>

    <main class="main-container" id="main-content">
        <aside class="filter-sidebar" id="filter-sidebar">
            <button class="close-btn" aria-label="Close Filter Sidebar" id="close-filter-sidebar"><span class="icon-x"></span></button>
            <h3>Filter Products</h3>

            <div class="filter-group">
                <details open>
                    <summary>Categories</summary>
                    <div class="filter-content category-tree">
                        <ul>
                            <li><a href="#" data-filter="category" data-value="all">All Categories</a></li>
                            <li>
                                <a href="#" data-filter="category" data-value="electronics">Electronics</a>
                                <ul>
                                    <li><a href="#" data-filter="category" data-value="smartphones">Smartphones</a></li>
                                    <li><a href="#" data-filter="category" data-value="laptops">Laptops</a></li>
                                    <li><a href="#" data-filter="category" data-value="headphones">Headphones</a></li>
                                </ul>
                            </li>
                            <li><a href="#" data-filter="category" data-value="home-appliances">Home Appliances</a></li>
                            <li><a href="#" data-filter="category" data-value="fashion">Fashion</a></li>
                        </ul>
                    </div>
                </details>
            </div>

            <div class="filter-group">
                <details open>
                    <summary>Price Range</summary>
                    <div class="filter-content price-range">
                        <div class="price-inputs">
                            <input type="number" id="price-min" value="0" min="0" aria-label="Minimum price">
                            <span>-</span>
                            <input type="number" id="price-max" value="1000" min="0" aria-label="Maximum price">
                        </div>
                        <button class="primary" id="apply-price-filter">Apply</button>
                    </div>
                </details>
            </div>

            <div class="filter-group">
                <details open>
                    <summary>Brands</summary>
                    <div class="filter-content checkbox-group" id="brand-filters">
                        <label><input type="checkbox" data-filter="brand" value="Apple"> Apple</label>
                        <label><input type="checkbox" data-filter="brand" value="Samsung"> Samsung</label>
                        <label><input type="checkbox" data-filter="brand" value="Google"> Google</label>
                        <label><input type="checkbox" data-filter="brand" value="Sony"> Sony</label>
                        <label><input type="checkbox" data-filter="brand" value="Xiaomi"> Xiaomi</label>
                    </div>
                </details>
            </div>

            <div class="filter-group">
                <details open>
                    <summary>Customer Rating</summary>
                    <div class="filter-content checkbox-group" id="rating-filters">
                        <label><input type="checkbox" data-filter="rating" value="4"> <span class="icon-star-filled"></span><span class="icon-star-filled"></span><span class="icon-star-filled"></span><span class="icon-star-filled"></span> & Up</label>
                        <label><input type="checkbox" data-filter="rating" value="3"> <span class="icon-star-filled"></span><span class="icon-star-filled"></span><span class="icon-star-filled"></span> & Up</label>
                    </div>
                </details>
            </div>

            <div class="filter-group">
                <details>
                    <summary>Color</summary>
                    <div class="filter-content color-swatches" id="color-filters">
                        <input type="radio" id="color-red" name="color-filter" value="red" hidden>
                        <label for="color-red" style="background-color: #e74c3c;" title="Red" data-filter="color"></label>
                        <input type="radio" id="color-blue" name="color-filter" value="blue" hidden>
                        <label for="color-blue" style="background-color: #3498db;" title="Blue" data-filter="color"></label>
                        <input type="radio" id="color-black" name="color-filter" value="black" hidden>
                        <label for="color-black" style="background-color: #2c3e50;" title="Black" data-filter="color"></label>
                        <input type="radio" id="color-white" name="color-filter" value="white" hidden>
                        <label for="color-white" style="background-color: #ecf0f1; border: 1px solid #ccc;" title="White" data-filter="color"></label>
                        <input type="radio" id="color-green" name="color-filter" value="green" hidden>
                        <label for="color-green" style="background-color: #2ecc71;" title="Green" data-filter="color"></label>
                    </div>
                </details>
            </div>

            <div class="filter-group">
                <details>
                    <summary>Other Attributes</summary>
                    <div class="filter-content checkbox-group" id="attribute-filters">
                        <label><input type="checkbox" data-filter="attribute" value="Wireless"> Wireless</label>
                        <label><input type="checkbox" data-filter="attribute" value="Waterproof"> Waterproof</label>
                        <label><input type="checkbox" data-filter="attribute" value="New_Arrival"> New Arrival</label>
                    </div>
                </details>
            </div>

            <button class="outline clear-filters-btn" id="clear-filters-btn">Clear All Filters</button>
        </aside>

        <section class="product-content-area" aria-labelledby="product-results-heading">
            <h2 id="product-results-heading" class="visually-hidden">Product Results</h2>
            <div class="hero-banner">
                <h1>Discover Our Latest Collection!</h1>
                <p>Explore a world of innovation and style. Limited-time offers await.</p>
                <button class="primary" onclick="alert('Shop Now Clicked!');">Shop Now</button>
            </div>

            <div class="product-controls">
                <div class="result-count" id="result-count">Showing 0 products of 0 total</div>
                <div class="sort-by">
                    <label for="sort-select" class="visually-hidden">Sort By:</label>
                    <select id="sort-select" aria-label="Sort products by">
                        <option value="popularity">Popularity</option>
                        <option value="newest">Newest Arrivals</option>
                        <option value="price-asc">Price: Low to High</option>
                        <option value="price-desc">Price: High to Low</option>
                        <option value="rating">Customer Review</option>
                    </select>
                </div>
                <div class="view-toggle" role="group" aria-label="Toggle product view">
                    <button class="grid-view-btn active" data-view="grid" aria-label="Grid view"><span class="icon-grid"></span></button>
                    <button class="list-view-btn" data-view="list" aria-label="List view"><span class="icon-list"></span></button>
                </div>
            </div>

            <div class="product-grid-container" id="product-grid">
                <!-- Product cards will be dynamically inserted here -->
            </div>

            <div class="empty-state" id="empty-state" style="display: none;">
                <h3>No Products Found!</h3>
                <p>It looks like there are no products matching your current filters. Try:</p>
                <button class="primary" id="empty-state-clear-filters">Clear All Filters</button>
                <button class="outline" onclick="alert('Browse other categories clicked');">Browse Other Categories</button>
            </div>

            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be dynamically inserted here -->
            </div>
        </section>

        <section class="related-products" aria-labelledby="related-products-heading">
            <h2 id="related-products-heading">You Might Also Like</h2>
            <div class="products-carousel" id="related-products-carousel">
                <!-- Related product cards will be dynamically inserted here (example) -->
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>ModernShop</h4>
                <p>Your one-stop destination for the latest electronics and gadgets. Quality, innovation, and style.</p>
                <div class="social-icons">
                    <a href="#" class="social-icon" aria-label="Facebook"><span class="icon-facebook">F</span></a> <!-- Dummy text for social icon -->
                    <a href="#" class="social-icon" aria-label="Twitter"><span class="icon-twitter">T</span></a>
                    <a href="#" class="social-icon" aria-label="Instagram"><span class="icon-instagram">I</span></a>
                </div>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Shipping & Returns</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Customer Service</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Track Order</a></li>
                    <li><a href="#">Support Center</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Newsletter</h4>
                <p>Stay updated with our latest offers and news!</p>
                <form class="newsletter-form" onsubmit="event.preventDefault(); alert('Subscribed!');">
                    <input type="email" placeholder="Your email address" aria-label="Enter your email for newsletter" required>
                    <button type="submit">Subscribe</button>
                </form>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2023 ModernShop. All rights reserved.
        </div>
    </footer>

    <button class="back-to-top" id="back-to-top" aria-label="Back to top">
        <span class="icon-arrow-up"></span>
    </button>

    <!-- Product Quick View Modal Structure -->
    <div class="modal-overlay" id="quick-view-modal">
        <div class="modal-content">
            <button class="modal-close-btn" aria-label="Close product quick view" id="modal-close-btn"><span class="icon-x"></span></button>
            <div class="modal-body">
                <div class="modal-image-gallery">
                    <div class="main-image-placeholder"></div>
                    <div class="thumbnail-images">
                        <div class="thumb-placeholder active" data-img-index="0"></div>
                        <div class="thumb-placeholder" data-img-index="1"></div>
                        <div class="thumb-placeholder" data-img-index="2"></div>
                        <div class="thumb-placeholder" data-img-index="3"></div>
                    </div>
                </div>
                <div class="modal-product-details">
                    <h2 id="modal-product-name">Product Name Placeholder</h2>
                    <div class="product-price">
                        <span class="current-price" id="modal-current-price">$0.00</span>
                        <span class="original-price" id="modal-original-price">$0.00</span>
                    </div>
                    <div class="product-rating" id="modal-product-rating">
                        <!-- Stars will be inserted here -->
                        <span class="rating-count">(0 Reviews)</span>
                    </div>
                    <p class="product-description" id="modal-product-description">
                        This is a short description of the product. It highlights key features and benefits, giving the user a quick overview.
                    </p>

                    <div class="options-group">
                        <label for="modal-color-select">Color:</label>
                        <select id="modal-color-select" aria-label="Select color">
                            <option value="black">Black</option>
                            <option value="silver">Silver</option>
                            <option value="gold">Gold</option>
                        </select>
                    </div>

                    <div class="options-group">
                        <label for="modal-size-select">Size:</label>
                        <select id="modal-size-select" aria-label="Select size">
                            <option value="small">Small</option>
                            <option value="medium">Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>

                    <div class="quantity-selector">
                        <label for="modal-quantity" class="visually-hidden">Quantity:</label>
                        <button class="icon-minus" aria-label="Decrease quantity" id="quantity-minus"></button>
                        <input type="number" id="modal-quantity" value="1" min="1" max="100" aria-live="polite">
                        <button class="icon-plus" aria-label="Increase quantity" id="quantity-plus"></button>
                    </div>

                    <div class="modal-actions">
                        <button class="primary add-to-cart-modal" id="modal-add-to-cart">Add to Cart</button>
                        <a href="#" class="view-full-product" id="modal-full-product-link">View Full Product Details →</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // Polyfill for NodeList.prototype.forEach for older browsers (IE11)
        if (window.NodeList && !NodeList.prototype.forEach) {
            NodeList.prototype.forEach = Array.prototype.forEach;
        }

        // --- GLOBAL STATE & DATA ---
        const ALL_PRODUCTS = [
            {
                id: 'p1', name: 'Ultra HD Smart TV', category: 'electronics', subCategory: 'televisions',
                price: 799.99, originalPrice: 999.99, brand: 'Sony', rating: 4.5, reviews: 120,
                colors: ['black', 'silver'], attributes: ['Smart TV', '4K'], badge: 'Sale',
                description: 'Experience stunning visuals with this Ultra HD Smart TV. Stream your favorite content in crisp 4K resolution.',
                imageCount: 4
            },
            {
                id: 'p2', name: 'Latest Pro Smartphone', category: 'electronics', subCategory: 'smartphones',
                price: 999.00, originalPrice: 1099.00, brand: 'Apple', rating: 4.8, reviews: 250,
                colors: ['black', 'silver', 'gold'], attributes: ['5G', 'Waterproof'], badge: 'New',
                description: 'Unleash unparalleled performance with the latest Pro Smartphone. Featuring a revolutionary camera system and stunning display.',
                imageCount: 3
            },
            {
                id: 'p3', name: 'Noise Cancelling Headphones', category: 'electronics', subCategory: 'headphones',
                price: 199.50, originalPrice: 249.00, brand: 'Sony', rating: 4.3, reviews: 85,
                colors: ['black', 'blue'], attributes: ['Wireless', 'Noise Cancelling'],
                description: 'Immerse yourself in pure sound with these comfortable noise cancelling headphones. Perfect for travel and daily commutes.',
                imageCount: 2
            },
            {
                id: 'p4', name: 'Slim Design Laptop', category: 'electronics', subCategory: 'laptops',
                price: 1199.00, originalPrice: 1300.00, brand: 'Google', rating: 4.6, reviews: 150,
                colors: ['silver', 'black'], attributes: ['Lightweight', 'High Performance'], badge: 'Sale',
                description: 'Boost your productivity with this ultra-slim laptop. Powerful performance packed in an elegant design.',
                imageCount: 3
            },
            {
                id: 'p5', name: 'Smart Home Hub', category: 'home-appliances', subCategory: 'smart-devices',
                price: 120.00, originalPrice: 150.00, brand: 'Google', rating: 4.2, reviews: 60,
                colors: ['white'], attributes: ['Smart Home', 'Voice Control'],
                description: 'Control all your smart devices with ease using this intuitive smart home hub. Simplify your life.',
                imageCount: 1
            },
            {
                id: 'p6', name: 'Vintage Leather Jacket', category: 'fashion', subCategory: 'jackets',
                price: 299.00, originalPrice: 350.00, brand: 'Zara', rating: 4.7, reviews: 45,
                colors: ['black', 'brown'], attributes: ['Leather', 'Stylish'],
                description: 'Elevate your style with this classic vintage leather jacket. Timeless design and premium quality.',
                imageCount: 2
            },
            {
                id: 'p7', name: 'Curved Gaming Monitor', category: 'electronics', subCategory: 'monitors',
                price: 499.00, originalPrice: 550.00, brand: 'Samsung', rating: 4.9, reviews: 90,
                colors: ['black'], attributes: ['Curved', 'Gaming'], badge: 'Limited Stock',
                description: 'Dominate the game with this immersive curved gaming monitor. High refresh rates and stunning visuals.',
                imageCount: 3
            },
            {
                id: 'p8', name: 'Wireless Ergonomic Mouse', category: 'electronics', subCategory: 'peripherals',
                price: 49.00, originalPrice: 60.00, brand: 'Logitech', rating: 4.1, reviews: 70,
                colors: ['black', 'grey'], attributes: ['Wireless', 'Ergonomic'],
                description: 'Boost your productivity and comfort with this ergonomic wireless mouse. Designed for long hours of use.',
                imageCount: 1
            },
            {
                id: 'p9', name: 'Portable Bluetooth Speaker', category: 'electronics', subCategory: 'audio',
                price: 75.00, originalPrice: 90.00, brand: 'JBL', rating: 4.4, reviews: 110,
                colors: ['red', 'blue', 'black'], attributes: ['Portable', 'Waterproof'],
                description: 'Take your music anywhere with this powerful and portable Bluetooth speaker. Great sound on the go.',
                imageCount: 2
            },
            {
                id: 'p10', name: 'Smartwatch Series 7', category: 'electronics', subCategory: 'wearables',
                price: 349.00, originalPrice: 399.00, brand: 'Apple', rating: 4.6, reviews: 180,
                colors: ['silver', 'black', 'red'], attributes: ['Fitness Tracker', 'GPS'],
                description: 'Stay connected and track your fitness goals with the Smartwatch Series 7. Advanced features for a healthier life.',
                imageCount: 3
            },
            {
                id: 'p11', name: 'High-Performance Blender', category: 'home-appliances', subCategory: 'kitchen',
                price: 150.00, originalPrice: 180.00, brand: 'Ninja', rating: 4.5, reviews: 55,
                colors: ['black', 'silver'], attributes: ['Powerful', 'Easy Clean'],
                description: 'Prepare delicious smoothies and meals with this high-performance blender. Durable and efficient.',
                imageCount: 1
            },
            {
                id: 'p12', name: 'Premium Espresso Machine', category: 'home-appliances', subCategory: 'kitchen',
                price: 450.00, originalPrice: 500.00, brand: 'DeLonghi', rating: 4.8, reviews: 75,
                colors: ['silver', 'black'], attributes: ['Automatic', 'Barista Quality'],
                description: 'Become your own barista with this premium espresso machine. Enjoy cafe-quality coffee at home.',
                imageCount: 2
            },
            {
                id: 'p13', name: 'Robot Vacuum Cleaner', category: 'home-appliances', subCategory: 'cleaning',
                price: 299.00, originalPrice: 320.00, brand: 'iRobot', rating: 4.3, reviews: 95,
                colors: ['black'], attributes: ['Smart', 'Self-Charging'],
                description: 'Keep your floors spotless with this intelligent robot vacuum cleaner. Schedules cleanings with ease.',
                imageCount: 2
            },
            {
                id: 'p14', name: '4K Action Camera', category: 'electronics', subCategory: 'cameras',
                price: 279.00, originalPrice: 300.00, brand: 'GoPro', rating: 4.7, reviews: 100,
                colors: ['black'], attributes: ['Waterproof', '4K Video'],
                description: 'Capture your adventures in stunning 4K with this rugged action camera. Built for extreme conditions.',
                imageCount: 3
            },
            {
                id: 'p15', name: 'Compact Digital Camera', category: 'electronics', subCategory: 'cameras',
                price: 399.00, originalPrice: 450.00, brand: 'Sony', rating: 4.2, reviews: 65,
                colors: ['black', 'silver'], attributes: ['Compact', 'High Resolution'],
                description: 'Perfect for everyday photography, this compact digital camera delivers high-quality images with ease.',
                imageCount: 2
            },
            {
                id: 'p16', name: 'Fitness Tracking Band', category: 'electronics', subCategory: 'wearables',
                price: 79.00, originalPrice: 90.00, brand: 'Xiaomi', rating: 4.0, reviews: 130,
                colors: ['black', 'red', 'blue'], attributes: ['Fitness Tracker', 'Heart Rate'],
                description: 'Monitor your health and activities with this comfortable fitness tracking band. Long battery life.',
                imageCount: 1
            }
        ];

        let currentFilters = {
            category: 'all',
            priceMin: 0,
            priceMax: 1000,
            brands: [],
            rating: 0,
            colors: [],
            attributes: [],
            search: ''
        };
        let currentSort = 'popularity';
        let currentPage = 1;
        const productsPerPage = 9; // Number of products to show per page
        let currentView = 'grid'; // 'grid' or 'list'
        let cartItemCount = 0;

        // --- DOM ELEMENTS ---
        const productGrid = document.getElementById('product-grid');
        const resultCountSpan = document.getElementById('result-count');
        const sortSelect = document.getElementById('sort-select');
        const viewToggleButtons = document.querySelectorAll('.view-toggle button');
        const paginationContainer = document.getElementById('pagination');
        const emptyState = document.getElementById('empty-state');
        const emptyStateClearFiltersBtn = document.getElementById('empty-state-clear-filters');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const priceMinInput = document.getElementById('price-min');
        const priceMaxInput = document.getElementById('price-max');
        const applyPriceFilterBtn = document.getElementById('apply-price-filter');
        const filterCheckboxes = document.querySelectorAll('#brand-filters input[type="checkbox"], #rating-filters input[type="checkbox"], #attribute-filters input[type="checkbox"]');
        const colorRadios = document.querySelectorAll('#color-filters input[type="radio"]');
        const categoryLinks = document.querySelectorAll('.category-tree a');
        const globalSearchInput = document.getElementById('global-search-input');
        const autocompleteResults = document.getElementById('autocomplete-results');
        const cartItemCountBadge = document.getElementById('cart-item-count');

        // Modal elements
        const quickViewModal = document.getElementById('quick-view-modal');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalProductName = document.getElementById('modal-product-name');
        const modalCurrentPrice = document.getElementById('modal-current-price');
        const modalOriginalPrice = document.getElementById('modal-original-price');
        const modalProductRating = document.getElementById('modal-product-rating');
        const modalProductDescription = document.getElementById('modal-product-description');
        const modalColorSelect = document.getElementById('modal-color-select');
        const modalSizeSelect = document.getElementById('modal-size-select');
        const modalQuantityInput = document.getElementById('modal-quantity');
        const quantityMinusBtn = document.getElementById('quantity-minus');
        const quantityPlusBtn = document.getElementById('quantity-plus');
        const modalAddToCartBtn = document.getElementById('modal-add-to-cart');
        const modalFullProductLink = document.getElementById('modal-full-product-link');
        const modalMainImagePlaceholder = document.querySelector('.modal-image-gallery .main-image-placeholder');
        const modalThumbnailImagesContainer = document.querySelector('.modal-image-gallery .thumbnail-images');

        // Mobile filter sidebar elements
        const mobileFilterToggle = document.getElementById('mobile-filter-toggle');
        const filterSidebar = document.getElementById('filter-sidebar');
        const closeFilterSidebar = document.getElementById('close-filter-sidebar');
        const filterOverlay = document.createElement('div');
        filterOverlay.className = 'filter-overlay';
        document.body.appendChild(filterOverlay);

        // Back-to-top button
        const backToTopBtn = document.getElementById('back-to-top');
        const toastContainer = document.getElementById('toast-container');

        // Related Products Carousel
        const relatedProductsCarousel = document.getElementById('related-products-carousel');

        // --- HELPER FUNCTIONS ---

        /**
         * Converts a string to a URL-friendly slug.
         * @param {string} text
         * @returns {string}
         */
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')           // Replace spaces with -
                .replace(/[^\w-]+/g, '')       // Remove all non-word chars
                .replace(/--+/g, '-')         // Replace multiple - with single -
                .replace(/^-+/, '')             // Trim - from start of text
                .replace(/-+$/, '');            // Trim - from end of text
        }

        /**
         * Simple debouncer for input events.
         * @param {Function} func The function to debounce.
         * @param {number} delay The debounce delay in ms.
         * @returns {Function}
         */
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), delay);
            };
        }

        /**
         * Displays a toast notification.
         * @param {string} message The message to display.
         * @param {'success'|'error'|'info'} type The type of toast.
         * @param {number} duration Duration in ms.
         */
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toastContainer.appendChild(toast);

            // Force reflow to ensure transition
            void toast.offsetWidth;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove(), { once: true });
            }, duration);
        }

        /**
         * Generates star rating HTML.
         * @param {number} rating
         * @returns {string} HTML string for stars.
         */
        function getStarRatingHtml(rating) {
            let starsHtml = '';
            for (let i = 1; i <= 5; i++) {
                if (rating >= i) {
                    starsHtml += '<span class="icon-star-filled"></span>';
                } else if (rating >= i - 0.5) {
                    // Placeholder for half star, using full star for simplicity
                    starsHtml += '<span class="icon-star-filled" style="opacity: 0.5;"></span>';
                } else {
                    starsHtml += '<span class="icon-star-empty"></span>';
                }
            }
            return starsHtml;
        }

        // --- PRODUCT RENDERING ---

        /**
         * Renders product cards based on filtered and sorted products.
         * @param {Array} productsToDisplay
         */
        function renderProducts(productsToDisplay) {
            productGrid.innerHTML = ''; // Clear existing products

            if (productsToDisplay.length === 0) {
                emptyState.style.display = 'block';
                productGrid.style.display = 'none';
                paginationContainer.style.display = 'none';
                resultCountSpan.textContent = `Showing 0 products of ${ALL_PRODUCTS.length} total`;
                return;
            } else {
                emptyState.style.display = 'none';
                productGrid.style.display = 'grid';
                paginationContainer.style.display = 'flex';
            }

            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const paginatedProducts = productsToDisplay.slice(startIndex, endIndex);

            paginatedProducts.forEach(product => {
                const card = document.createElement('article');
                card.className = 'product-card';
                card.setAttribute('data-id', product.id); // Add data-id for quick view

                const originalPriceHtml = product.originalPrice ? `<span class="original-price">$${product.originalPrice.toFixed(2)}</span>` : '';
                const badgeHtml = product.badge ? `<span class="product-badge ${product.badge.toLowerCase().replace(' ', '-')}">${product.badge}</span>` : '';

                card.innerHTML = `
                    ${badgeHtml}
                    <div class="product-image-placeholder"></div>
                    <div class="product-info">
                        <a href="#" class="product-name" title="${product.name}">${product.name}</a>
                        <div class="product-price">
                            <span class="current-price">$${product.price.toFixed(2)}</span>
                            ${originalPriceHtml}
                        </div>
                        <div class="product-rating" aria-label="Rated ${product.rating} out of 5 stars">
                            ${getStarRatingHtml(product.rating)}
                            <span class="rating-count">(${product.reviews} reviews)</span>
                        </div>
                        <div class="product-actions">
                            <button class="primary add-to-cart" data-id="${product.id}" aria-label="Add ${product.name} to cart">Add to Cart</button>
                            <button class="wishlist-btn" data-id="${product.id}" aria-label="Add ${product.name} to wishlist"><span class="icon-heart"></span></button>
                            <button class="quick-view-btn" data-id="${product.id}" aria-label="Quick view ${product.name}"><span class="icon-eye"></span></button>
                        </div>
                    </div>
                `;
                productGrid.appendChild(card);
            });

            // Update result count
            resultCountSpan.textContent = `Showing ${paginatedProducts.length} products of ${productsToDisplay.length} total`;

            // Update pagination
            renderPagination(productsToDisplay.length);
        }

        /**
         * Renders pagination buttons.
         * @param {number} totalProducts
         */
        function renderPagination(totalProducts) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalProducts / productsPerPage);

            if (totalPages <= 1) return;

            const createPageButton = (page, text, disabled = false) => {
                const button = document.createElement('button');
                button.textContent = text;
                button.setAttribute('data-page', page);
                button.disabled = disabled;
                if (page === currentPage) {
                    button.classList.add('active');
                }
                button.addEventListener('click', () => {
                    currentPage = page;
                    applyFiltersAndSort();
                });
                return button;
            };

            paginationContainer.appendChild(createPageButton(currentPage - 1, 'Previous', currentPage === 1));

            // Show current page, and a few around it
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                paginationContainer.appendChild(createPageButton(1, '1'));
                if (startPage > 2) {
                    const span = document.createElement('span');
                    span.textContent = '...';
                    paginationContainer.appendChild(span);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationContainer.appendChild(createPageButton(i, i.toString()));
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const span = document.createElement('span');
                    span.textContent = '...';
                    paginationContainer.appendChild(span);
                }
                paginationContainer.appendChild(createPageButton(totalPages, totalPages.toString()));
            }

            paginationContainer.appendChild(createPageButton(currentPage + 1, 'Next', currentPage === totalPages));
        }

        /**
         * Filters products based on currentFilters state.
         * @returns {Array} Filtered products.
         */
        function filterProducts() {
            let filtered = ALL_PRODUCTS;

            // Category filter
            if (currentFilters.category && currentFilters.category !== 'all') {
                filtered = filtered.filter(p => p.category === currentFilters.category || p.subCategory === currentFilters.category);
            }

            // Price range filter
            filtered = filtered.filter(p => p.price >= currentFilters.priceMin && p.price <= currentFilters.priceMax);

            // Brand filter
            if (currentFilters.brands.length > 0) {
                filtered = filtered.filter(p => currentFilters.brands.includes(p.brand));
            }

            // Rating filter
            if (currentFilters.rating > 0) {
                filtered = filtered.filter(p => p.rating >= currentFilters.rating);
            }

            // Color filter
            if (currentFilters.colors.length > 0) {
                filtered = filtered.filter(p => p.colors && p.colors.some(c => currentFilters.colors.includes(c)));
            }

            // Attribute filter
            if (currentFilters.attributes.length > 0) {
                filtered = filtered.filter(p => p.attributes && p.attributes.some(attr => currentFilters.attributes.includes(attr)));
            }

            // Search filter
            if (currentFilters.search) {
                const searchTerm = currentFilters.search.toLowerCase();
                filtered = filtered.filter(p =>
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.description.toLowerCase().includes(searchTerm) ||
                    p.brand.toLowerCase().includes(searchTerm)
                );
            }

            return filtered;
        }

        /**
         * Sorts products based on currentSort state.
         * @param {Array} products
         * @returns {Array} Sorted products.
         */
        function sortProducts(products) {
            return [...products].sort((a, b) => {
                if (currentSort === 'popularity') {
                    // Higher reviews count means more popular
                    return b.reviews - a.reviews;
                } else if (currentSort === 'newest') {
                    // For demo, just use ID as a proxy for newest (higher ID = newer)
                    return b.id.localeCompare(a.id);
                } else if (currentSort === 'price-asc') {
                    return a.price - b.price;
                } else if (currentSort === 'price-desc') {
                    return b.price - a.price;
                } else if (currentSort === 'rating') {
                    return b.rating - a.rating;
                }
                return 0;
            });
        }

        /**
         * Applies all filters and sorting, then renders products.
         */
        function applyFiltersAndSort() {
            const filtered = filterProducts();
            const sorted = sortProducts(filtered);
            renderProducts(sorted);
            updateURLParameters();
        }

        /**
         * Updates filter UI based on currentFilters state.
         */
        function updateFilterUI() {
            // Price inputs
            priceMinInput.value = currentFilters.priceMin;
            priceMaxInput.value = currentFilters.priceMax;

            // Checkboxes (brands, rating, attributes)
            filterCheckboxes.forEach(checkbox => {
                const filterType = checkbox.dataset.filter;
                const filterValue = checkbox.value;
                if (currentFilters[filterType + 's'] && currentFilters[filterType + 's'].includes(filterValue)) {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });

            // Color radios
            colorRadios.forEach(radio => {
                if (currentFilters.colors.includes(radio.value)) {
                    radio.checked = true;
                } else {
                    radio.checked = false;
                }
            });

            // Category links
            categoryLinks.forEach(link => {
                if (link.dataset.value === currentFilters.category) {
                    link.classList.add('active'); // Add a visual active state for categories
                } else {
                    link.classList.remove('active');
                }
            });

            // Search input
            globalSearchInput.value = currentFilters.search;

            // Sort select
            sortSelect.value = currentSort;
        }


        /**
         * Updates URL query parameters to reflect current filters and sort state.
         */
        function updateURLParameters() {
            const params = new URLSearchParams();

            if (currentFilters.category && currentFilters.category !== 'all') {
                params.set('category', currentFilters.category);
            }
            if (currentFilters.priceMin !== 0) {
                params.set('price_min', currentFilters.priceMin);
            }
            // Only set price_max if it's not the default high value or if price_min is set
            if (currentFilters.priceMax !== 1000 || currentFilters.priceMin !== 0) {
                 params.set('price_max', currentFilters.priceMax);
            }
            if (currentFilters.brands.length > 0) {
                params.set('brands', currentFilters.brands.join(','));
            }
            if (currentFilters.rating > 0) {
                params.set('rating', currentFilters.rating);
            }
            if (currentFilters.colors.length > 0) {
                params.set('colors', currentFilters.colors.join(','));
            }
            if (currentFilters.attributes.length > 0) {
                params.set('attributes', currentFilters.attributes.join(','));
            }
            if (currentFilters.search) {
                params.set('search', currentFilters.search);
            }

            if (currentSort !== 'popularity') { // Default sort
                params.set('sort', currentSort);
            }
            if (currentPage > 1) {
                params.set('page', currentPage);
            }
            if (currentView !== 'grid') { // Default view
                params.set('view', currentView);
            }

            const newUrl = `${window.location.pathname}?${params.toString()}`;
            window.history.pushState(currentFilters, '', newUrl); // Use currentFilters as state object
        }

        /**
         * Reads URL query parameters and initializes filters.
         */
        function initializeFiltersFromURL() {
            const params = new URLSearchParams(window.location.search);

            currentFilters.category = params.get('category') || 'all';
            currentFilters.priceMin = parseFloat(params.get('price_min')) || 0;
            currentFilters.priceMax = parseFloat(params.get('price_max')) || 1000;
            currentFilters.brands = params.get('brands') ? params.get('brands').split(',') : [];
            currentFilters.rating = parseFloat(params.get('rating')) || 0;
            currentFilters.colors = params.get('colors') ? params.get('colors').split(',') : [];
            currentFilters.attributes = params.get('attributes') ? params.get('attributes').split(',') : [];
            currentFilters.search = params.get('search') || '';

            currentSort = params.get('sort') || 'popularity';
            currentPage = parseInt(params.get('page')) || 1;
            currentView = params.get('view') || 'grid';

            // Apply view state
            if (currentView === 'list') {
                productGrid.classList.add('list-view');
                document.querySelector('.view-toggle .grid-view-btn').classList.remove('active');
                document.querySelector('.view-toggle .list-view-btn').classList.add('active');
            } else {
                productGrid.classList.remove('list-view');
                document.querySelector('.view-toggle .grid-view-btn').classList.add('active');
                document.querySelector('.view-toggle .list-view-btn').classList.remove('active');
            }

            updateFilterUI(); // Update UI elements based on parsed URL
        }

        /**
         * Renders the "You Might Also Like" section.
         * @param {Array} products
         */
        function renderRelatedProducts(products) {
            relatedProductsCarousel.innerHTML = '';
            const randomProducts = [...products].sort(() => 0.5 - Math.random()).slice(0, 6); // Get 6 random products

            randomProducts.forEach(product => {
                const card = document.createElement('article');
                card.className = 'product-card';
                card.setAttribute('data-id', product.id);

                const originalPriceHtml = product.originalPrice ? `<span class="original-price">$${product.originalPrice.toFixed(2)}</span>` : '';
                const badgeHtml = product.badge ? `<span class="product-badge ${product.badge.toLowerCase().replace(' ', '-')}">${product.badge}</span>` : '';

                card.innerHTML = `
                    ${badgeHtml}
                    <div class="product-image-placeholder"></div>
                    <div class="product-info">
                        <a href="#" class="product-name" title="${product.name}">${product.name}</a>
                        <div class="product-price">
                            <span class="current-price">$${product.price.toFixed(2)}</span>
                            ${originalPriceHtml}
                        </div>
                        <div class="product-rating" aria-label="Rated ${product.rating} out of 5 stars">
                            ${getStarRatingHtml(product.rating)}
                            <span class="rating-count">(${product.reviews} reviews)</span>
                        </div>
                        <div class="product-actions">
                            <button class="primary add-to-cart" data-id="${product.id}" aria-label="Add ${product.name} to cart">Add to Cart</button>
                            <button class="wishlist-btn" data-id="${product.id}" aria-label="Add ${product.name} to wishlist"><span class="icon-heart"></span></button>
                            <button class="quick-view-btn" data-id="${product.id}" aria-label="Quick view ${product.name}"><span class="icon-eye"></span></button>
                        </div>
                    </div>
                `;
                relatedProductsCarousel.appendChild(card);
            });
        }


        // --- EVENT LISTENERS ---

        document.addEventListener('DOMContentLoaded', () => {
            initializeFiltersFromURL(); // Initialize from URL on load
            applyFiltersAndSort(); // Perform initial render
            renderRelatedProducts(ALL_PRODUCTS); // Render related products

            // Update cart item count
            cartItemCountBadge.textContent = cartItemCount;
        });

        // Event for filter checkboxes (brands, rating, attributes)
        filterCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                const filterType = e.target.dataset.filter;
                const filterValue = e.target.value;
                const filterArray = currentFilters[filterType + 's']; // e.g., currentFilters.brands

                if (e.target.checked) {
                    if (!filterArray.includes(filterValue)) {
                        filterArray.push(filterValue);
                    }
                } else {
                    const index = filterArray.indexOf(filterValue);
                    if (index > -1) {
                        filterArray.splice(index, 1);
                    }
                }
                currentPage = 1; // Reset to first page on filter change
                applyFiltersAndSort();
            });
        });

        // Event for color radio buttons
        colorRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                currentFilters.colors = e.target.checked ? [e.target.value] : [];
                currentPage = 1;
                applyFiltersAndSort();
            });
        });

        // Event for category links
        categoryLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                currentFilters.category = e.target.dataset.value;
                currentPage = 1;
                applyFiltersAndSort();
            });
        });

        // Event for price range apply button
        applyPriceFilterBtn.addEventListener('click', () => {
            const min = parseFloat(priceMinInput.value) || 0;
            const max = parseFloat(priceMaxInput.value) || 0;
            currentFilters.priceMin = Math.max(0, min);
            currentFilters.priceMax = Math.max(currentFilters.priceMin, max); // Ensure max is not less than min
            priceMinInput.value = currentFilters.priceMin; // Update input to sanitized value
            priceMaxInput.value = currentFilters.priceMax; // Update input to sanitized value
            currentPage = 1;
            applyFiltersAndSort();
        });

        // Event for sort select
        sortSelect.addEventListener('change', (e) => {
            currentSort = e.target.value;
            currentPage = 1;
            applyFiltersAndSort();
        });

        // Event for clear all filters button
        clearFiltersBtn.addEventListener('click', () => {
            currentFilters = {
                category: 'all',
                priceMin: 0,
                priceMax: 1000,
                brands: [],
                rating: 0,
                colors: [],
                attributes: [],
                search: ''
            };
            currentPage = 1;
            updateFilterUI(); // Reset UI elements
            applyFiltersAndSort();
            showToast('All filters cleared!', 'info');
        });

        // Event for empty state clear filters button
        emptyStateClearFiltersBtn.addEventListener('click', () => {
            clearFiltersBtn.click(); // Reuse the existing clear filters logic
        });

        // Event for grid/list view toggle
        viewToggleButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                currentView = e.currentTarget.dataset.view;
                viewToggleButtons.forEach(btn => btn.classList.remove('active'));
                e.currentTarget.classList.add('active');
                if (currentView === 'list') {
                    productGrid.classList.add('list-view');
                } else {
                    productGrid.classList.remove('list-view');
                }
                updateURLParameters();
            });
        });

        // Event delegation for "Add to Cart", "Wishlist", "Quick View" buttons
        productGrid.addEventListener('click', (e) => {
            const productId = e.target.dataset.id || e.target.closest('button')?.dataset.id;
            if (!productId) return;

            const product = ALL_PRODUCTS.find(p => p.id === productId);
            if (!product) return;

            if (e.target.classList.contains('add-to-cart') || e.target.closest('.add-to-cart')) {
                cartItemCount++;
                cartItemCountBadge.textContent = cartItemCount;
                showToast(`${product.name} added to cart!`, 'success');
            } else if (e.target.classList.contains('wishlist-btn') || e.target.closest('.wishlist-btn')) {
                showToast(`${product.name} added to wishlist!`, 'info');
            } else if (e.target.classList.contains('quick-view-btn') || e.target.closest('.quick-view-btn')) {
                openQuickViewModal(product);
            }
        });

        // Global search input with debounce and autocomplete
        const handleSearchInput = debounce(() => {
            const searchTerm = globalSearchInput.value.trim();
            currentFilters.search = searchTerm;
            currentPage = 1;
            applyFiltersAndSort();

            if (searchTerm.length > 1) {
                const suggestions = ALL_PRODUCTS
                    .filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))
                    .map(p => p.name)
                    .slice(0, 5); // Limit suggestions

                renderAutocompleteSuggestions(suggestions);
            } else {
                autocompleteResults.style.display = 'none';
            }
        }, 300); // Debounce by 300ms

        globalSearchInput.addEventListener('input', handleSearchInput);

        function renderAutocompleteSuggestions(suggestions) {
            const ul = autocompleteResults.querySelector('ul');
            ul.innerHTML = '';
            if (suggestions.length === 0) {
                autocompleteResults.style.display = 'none';
                return;
            }

            suggestions.forEach(suggestion => {
                const li = document.createElement('li');
                li.textContent = suggestion;
                li.addEventListener('click', () => {
                    globalSearchInput.value = suggestion;
                    currentFilters.search = suggestion;
                    currentPage = 1;
                    applyFiltersAndSort();
                    autocompleteResults.style.display = 'none';
                });
                ul.appendChild(li);
            });
            autocompleteResults.style.display = 'block';
        }

        document.addEventListener('click', (e) => {
            if (!globalSearchInput.contains(e.target) && !autocompleteResults.contains(e.target)) {
                autocompleteResults.style.display = 'none';
            }
        });


        // --- QUICK VIEW MODAL LOGIC ---
        let currentModalProduct = null;

        function openQuickViewModal(product) {
            currentModalProduct = product;
            modalProductName.textContent = product.name;
            modalCurrentPrice.textContent = `$${product.price.toFixed(2)}`;
            modalOriginalPrice.textContent = product.originalPrice ? `$${product.originalPrice.toFixed(2)}` : '';
            modalProductDescription.textContent = product.description;
            modalFullProductLink.href = `#product-${product.id}`; // Dummy link
            modalQuantityInput.value = 1; // Reset quantity

            // Populate ratings
            modalProductRating.innerHTML = `${getStarRatingHtml(product.rating)} <span class="rating-count">(${product.reviews} reviews)</span>`;

            // Populate color options
            modalColorSelect.innerHTML = product.colors ? product.colors.map(color => `<option value="${color}">${color.charAt(0).toUpperCase() + color.slice(1)}</option>`).join('') : '<option value="default">N/A</option>';
            modalColorSelect.value = product.colors && product.colors.length > 0 ? product.colors[0] : 'default';

            // Populate size options (dummy, as not in product data)
            modalSizeSelect.innerHTML = `<option value="S">S</option><option value="M">M</option><option value="L">L</option>`;
            modalSizeSelect.value = 'M';

            // Render modal image gallery
            renderModalImageGallery(product);

            quickViewModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent body scroll
            modalQuantityInput.setAttribute('aria-label', `Quantity for ${product.name}`);
            modalColorSelect.setAttribute('aria-label', `Select color for ${product.name}`);
            modalSizeSelect.setAttribute('aria-label', `Select size for ${product.name}`);
        }

        function renderModalImageGallery(product) {
            // Main image
            modalMainImagePlaceholder.style.background = `linear-gradient(135deg, ${getRandomColor()}, ${getRandomColor()})`;
            modalMainImagePlaceholder.innerHTML = `<p style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7); font-size: var(--font-size-lg);">Image 1 of ${product.imageCount}</p>`;

            // Thumbnails
            modalThumbnailImagesContainer.innerHTML = '';
            for (let i = 0; i < product.imageCount; i++) {
                const thumb = document.createElement('div');
                thumb.className = `thumb-placeholder${i === 0 ? ' active' : ''}`;
                thumb.setAttribute('data-img-index', i);
                thumb.style.background = `linear-gradient(90deg, ${getRandomColor()}, ${getRandomColor()})`;
                thumb.addEventListener('click', () => {
                    // Update main image placeholder background and text
                    modalMainImagePlaceholder.style.background = `linear-gradient(135deg, ${getRandomColor()}, ${getRandomColor()})`;
                    modalMainImagePlaceholder.innerHTML = `<p style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: rgba(255,255,255,0.7); font-size: var(--font-size-lg);">Image ${i + 1} of ${product.imageCount}</p>`;
                    // Update active state on thumbnails
                    modalThumbnailImagesContainer.querySelectorAll('.thumb-placeholder').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                });
                modalThumbnailImagesContainer.appendChild(thumb);
            }
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }


        function closeQuickViewModal() {
            quickViewModal.classList.remove('active');
            document.body.style.overflow = ''; // Restore body scroll
            currentModalProduct = null;
        }

        modalCloseBtn.addEventListener('click', closeQuickViewModal);
        quickViewModal.addEventListener('click', (e) => {
            if (e.target === quickViewModal) {
                closeQuickViewModal();
            }
        });

        // Modal Quantity Selector
        quantityMinusBtn.addEventListener('click', () => {
            let currentQuantity = parseInt(modalQuantityInput.value);
            if (currentQuantity > 1) {
                modalQuantityInput.value = currentQuantity - 1;
            }
        });
        quantityPlusBtn.addEventListener('click', () => {
            let currentQuantity = parseInt(modalQuantityInput.value);
            if (currentQuantity < 100) { // Max quantity
                modalQuantityInput.value = currentQuantity + 1;
            }
        });
        modalQuantityInput.addEventListener('change', (e) => {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 1) {
                e.target.value = 1;
            } else if (val > 100) {
                e.target.value = 100;
            }
        });

        modalAddToCartBtn.addEventListener('click', () => {
            if (currentModalProduct) {
                const quantity = parseInt(modalQuantityInput.value);
                cartItemCount += quantity;
                cartItemCountBadge.textContent = cartItemCount;
                showToast(`${quantity}x ${currentModalProduct.name} added to cart!`, 'success');
                closeQuickViewModal();
            }
        });

        // --- MOBILE FILTER SIDEBAR LOGIC ---
        mobileFilterToggle.addEventListener('click', () => {
            filterSidebar.classList.add('active');
            filterOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            mobileFilterToggle.setAttribute('aria-expanded', 'true');
        });

        closeFilterSidebar.addEventListener('click', () => {
            filterSidebar.classList.remove('active');
            filterOverlay.classList.remove('active');
            document.body.style.overflow = '';
            mobileFilterToggle.setAttribute('aria-expanded', 'false');
        });

        filterOverlay.addEventListener('click', () => {
            closeFilterSidebar.click(); // Use the close button's click handler
        });


        // --- BACK-TO-TOP BUTTON LOGIC ---
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) { // Show button after scrolling 300px
                backToTopBtn.classList.add('show');
            } else {
                backToTopBtn.classList.remove('show');
            }
        });

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // --- DUMMY SOCIAL ICONS (for footer) ---
        // Just adding basic content for the 'F', 'T', 'I' in the CSS, no actual SVGs or font awesome
        // This is primarily for visual layout demonstration.
    </script>
</body>
</html>